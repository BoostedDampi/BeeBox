import socket
import struct

#This function configures the Beebox with connection window time and debug mode
def configBeebox(ip, port, sleeptime, cap=True, debug=False):

	if cap and time > 48: #This is a security feature
		raise Exception("Sleep time is capped at 48h, you can stop this by setting cap=False")

	command = "1" + str(int(debug)) + str(sleeptime)

	if connect(ip, port, command) == NULL:
		return False
	return True

#the status request should give back a few info: connection strenght, battery voltage, debug mode
def statusRequest(ip, port):
	rec_data = connect(ip, port, "2") #es. 02(02-30)231(2.31)0(0 o 1)

	if connect(ip, port, command) == NULL:
		return "NULL"
	return rec_data[0:2], rec_data[2:5], bool(rec_data[5])

#data request gives back the weight
def dataRequest(ip, port)
	rec_data = connect(ip, port, "3") #es. 02(02-30)231(2.31)0(0 o 1)

	if connect(ip, port, command) == NULL:
		return "NULL"
	return struct.unpack("!d", rec_data)

def connect(ip, port, data):

	with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
		try:
			s.connect((ip, port))
			print("Sending data: " + data)
			s.sendall(str.encode(data))
			response = s.recv(1024)
			response = unpack('!i', response)
			print("BeeBox response: " + response)
			if not response:
				raise Exception("FATAL: BeeBox didn't send any data, wtf?")
			return response
		except TimeoutError:
			print("FATAL: Connection Timeout")
			s.close()
			return "NULL"
		except:
			print("FATAL: General connection error")
			s.close()
			return "NULL"


if __name__ == "__main__":
	print("Trying to connect:")

	



		
		



















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































while True:
	print(cazzo)